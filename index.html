<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Timeline Planner</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ─────────────────────────────────────────
           TRU THEME  (unchanged palettes)
           ───────────────────────────────────────── */
        :root {
            --tru-primary: #0055A5;
            --tru-accent: #0072CE;
            --tru-secondary: #4A90E2;
            --tru-gradient: linear-gradient(135deg, #0055A5 0%, #0072CE 50%, #4A90E2 100%);
            --tru-gradient-soft: linear-gradient(135deg, rgba(0,85,165,0.1) 0%, rgba(0,114,206,0.05) 100%);
            --tru-white: #FFFFFF;
            --tru-off-white: #FAFBFC;
            --tru-gray-50: #F8FAFC;
            --tru-gray-100: #F1F5F9;
            --tru-gray-200: #E2E8F0;
            --tru-gray-300: #CBD5E1;
            --tru-gray-400: #94A3B8;
            --tru-gray-500: #64748B;
            --tru-gray-600: #475569;
            --tru-gray-700: #334155;
            --tru-gray-800: #1E293B;
            --tru-gray-900: #0F172A;
            --tru-shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --tru-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --tru-shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --tru-shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --tru-shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            --tru-shadow-glow: 0 0 0 1px rgb(0 114 206 / 0.1), 0 4px 16px rgb(0 114 206 / 0.12);
            --tru-radius-sm: 8px;
            --tru-radius: 12px;
            --tru-radius-lg: 16px;
            --tru-radius-xl: 24px;
            --tru-font: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --tru-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --tru-transition-bounce: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        * { box-sizing: border-box; }
        body {
            font-family: var(--tru-font);
            background: linear-gradient(135deg, #f6f9fc 0%, #e9f2ff 100%);
            color: var(--tru-gray-800);
            margin: 0; padding: 0; min-height: 100vh;
            line-height: 1.6; font-feature-settings: "rlig" 1, "calt" 1;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        body::before { /* soft background décor */
            content: ''; position: fixed; inset: 0; pointer-events:none; z-index:-1;
            background:
                radial-gradient(circle at 20% 20%, rgba(0,114,206,0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(0,85,165,0.02) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(74,144,226,0.01) 0%, transparent 50%);
        }

        /* ─────────────────────────────────────────
           STRUCTURE & TYPOGRAPHY
           ───────────────────────────────────────── */
        .timeline-container { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; position: relative; }
        .timeline-container::before { content:''; position:absolute; inset: -5%; background:var(--tru-white); border-radius:var(--tru-radius-xl); box-shadow:var(--tru-shadow-2xl); opacity:0.6; z-index:-2; }

        .branding-bar { display:flex; align-items:center; justify-content:center; gap:2rem; margin-bottom:3rem; padding:1.5rem; background:var(--tru-gradient-soft); border-radius:var(--tru-radius-lg); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.2); }
        .tru-logo { height:64px; width:auto; filter:drop-shadow(0 2px 4px rgba(0,0,0,.1)); }
        h1 { background:var(--tru-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-weight:700; font-size:2.5rem; text-align:center; margin-bottom:2rem; }

        /* ─────────────────────────────────────────
           PROGRESS BAR (unchanged)
           ───────────────────────────────────────── */
        .progress-bar{width:100%;height:8px;background:var(--tru-gray-200);border-radius:4px;margin-bottom:3rem;overflow:hidden;position:relative;box-shadow:inset 0 1px 2px rgba(0,0,0,0.1);}        
        .progress-bar::before{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 2s infinite;}        
        .progress-bar-inner{height:100%;background:var(--tru-gradient);border-radius:4px;transition:width 1s cubic-bezier(0.4,0,0.2,1);position:relative;overflow:hidden;}        
        .progress-bar-inner::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:progressShine 2s infinite;}        

        /* ─────────────────────────────────────────
           SET‑UP SECTION / CONTROLS  (unchanged)
           ───────────────────────────────────────── */
        /* ... existing .setup-section, .controls, button styles kept here unchanged ... */

        /* ─────────────────────────────────────────
           TIMELINE – **scroll‑snap carousel**
           ───────────────────────────────────────── */
        .timeline-scroll-container {
            position: relative;
            background: var(--tru-white);
            border-radius: var(--tru-radius-lg);
            box-shadow: var(--tru-shadow-xl);
            border: 1px solid var(--tru-gray-100);
            overflow-x: auto; overflow-y: visible;
            min-height: 480px; padding: 0;   /* removed horizontal padding so each year fits */
            scrollbar-width: thin; scrollbar-color: var(--tru-gray-300) var(--tru-gray-100);
            /* NEW */
            scroll-snap-type: x mandatory;
        }
        .timeline-scroll-container::-webkit-scrollbar{height:12px;background:var(--tru-gray-100);}        
        .timeline-scroll-container::-webkit-scrollbar-thumb{background:var(--tru-gradient);border-radius:6px;border:2px solid var(--tru-gray-100);}        
        .timeline-scroll-container::-webkit-scrollbar-thumb:hover{background:var(--tru-primary);}        

        .timeline-years{
            display:flex; flex-direction:row; gap:0; /* gap handled by internal padding */
            min-height:400px; overflow:visible; width:100%; /* full width row */
        }
        .timeline-years.dragging{cursor:grabbing;user-select:none;}
        .timeline-years:not(.dragging){cursor:grab;}

        /* YEAR BLOCK – now one per viewport */
        .year-block{
            background:var(--tru-white);
            border-radius:var(--tru-radius-lg);
            box-shadow:var(--tru-shadow-lg);
            border:1px solid var(--tru-gray-100);
            flex:0 0 100%;           /* take full viewport width */
            max-width:100%; min-width:100%;
            display:flex; flex-direction:column; padding:2rem 1.5rem; position:relative; overflow:hidden;
            scroll-snap-align:center;   /* key for carousel */
        }
        .year-block::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:var(--tru-gradient);opacity:0.8;}
        .year-title{background:var(--tru-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:1.5rem;font-weight:700;margin-bottom:1.5rem;text-align:center;letter-spacing:-0.025em;}
        .year-semesters{display:flex;flex-direction:row;gap:1.5rem;justify-content:space-between;padding:0 10%;} /* centred nicely */

        /* SEMESTER CELL  (unchanged visuals) */
        .semester-cell{background:var(--tru-gray-50);border:2px solid var(--tru-gray-200);border-radius:var(--tru-radius-lg);width:180px;min-width:180px;max-width:180px;height:140px;min-height:140px;max-height:140px;cursor:pointer;transition:var(--tru-transition-bounce);position:relative;display:flex;flex-direction:column;padding:1.5rem 1.25rem;gap:0.75rem;overflow:hidden;backdrop-filter:blur(10px);}        
        /* ... rest of semester cell, modal, animations, responsive, accessibility  unchanged ... */

        /* ─────────────────────────────────────────
           YEAR NAVIGATION ARROWS
           ───────────────────────────────────────── */
        .year-nav{position:absolute;top:50%;transform:translateY(-50%);width:46px;height:46px;border-radius:50%;background:var(--tru-gradient);color:#fff;font-size:1.4rem;font-weight:700;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--tru-shadow-lg);z-index:10;opacity:0.85;transition:var(--tru-transition);}        
        .year-nav:hover{opacity:1;transform:translateY(-50%) scale(1.05);}        
        .year-nav.left {left: -18px;}   /* sit just outside */
        .year-nav.right{right:-18px;}   
        @media (max-width:768px){.year-nav{display:none;}}  /* hide on mobile – users can swipe */

        /*  Remaining original media queries, print styles, keyframe animations  preserved. */
    </style>
</head>
<body>
    <main class="timeline-container">
        <!-- Branding -->
        <div class="branding-bar">
            <div class="tru-logo" style="width:200px;height:64px;background:var(--tru-gradient);border-radius:8px;display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:1.2rem;">
                TRU LOGO
            </div>
        </div>
        <!-- Heading -->
        <h1>Your Path Through TRU</h1>
        <!-- Progress bar -->
        <div class="progress-bar" aria-hidden="true">
            <div class="progress-bar-inner" id="progress-bar-inner" style="width:0%"></div>
        </div>
        <!-- Setup -->
        <div id="setup-section" class="setup-section">
            <label for="years-input">Years until graduation (1‑6):</label>
            <input type="number" id="years-input" min="1" max="6" value="4">
            <button id="generate-btn" class="primary-btn">Generate Timeline</button>
            <button id="reset-btn" class="reset-btn" hidden>Reset Timeline</button>
        </div>

        <!-- Timeline carousel container -->
        <div class="timeline-scroll-container">
            <!-- nav arrows -->
            <div class="year-nav left" id="prev-year" aria-label="Previous year" role="button" tabindex="0">&#x2190;</div>
            <div class="year-nav right" id="next-year" aria-label="Next year" role="button" tabindex="0">&#x2192;</div>
            <div id="timeline-years" class="timeline-years" tabindex="0"></div>
        </div>

        <!-- Controls -->
        <div id="controls" class="controls" hidden>
            <button id="download-btn" class="secondary-btn">Download Plan (.txt)</button>
            <button id="print-btn" class="secondary-btn">Print to PDF</button>
        </div>

        <!-- Modal -->
        <div id="edit-modal" class="modal" hidden>
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                <h2 id="modal-title">Edit Plan</h2>
                <textarea id="plan-text" placeholder="Enter your semester plan..."></textarea>
                <div class="modal-buttons">
                    <button id="save-btn" class="primary-btn">Save</button>
                    <button id="cancel-btn" class="secondary-btn">Cancel</button>
                </div>
            </div>
        </div>
        <div id="aria-live" aria-live="polite" role="status"></div>
    </main>

    <script>
        /* ==============================================================
           STATE & DOM REFS
        ===============================================================*/
        const timelineData = new Map();
        let currentEditCell = null;
        let yearsCount = 0;
        let currentYearIdx = 0;
        let yearBlocks = [];

        // Elements
        const yearsInput    = document.getElementById('years-input');
        const generateBtn   = document.getElementById('generate-btn');
        const resetBtn      = document.getElementById('reset-btn');
        const timelineYears = document.getElementById('timeline-years');
        const container     = document.querySelector('.timeline-scroll-container');
        const prevBtn       = document.getElementById('prev-year');
        const nextBtn       = document.getElementById('next-year');
        const controls      = document.getElementById('controls');
        const downloadBtn   = document.getElementById('download-btn');
        const printBtn      = document.getElementById('print-btn');
        const editModal     = document.getElementById('edit-modal');
        const planText      = document.getElementById('plan-text');
        const saveBtn       = document.getElementById('save-btn');
        const cancelBtn     = document.getElementById('cancel-btn');
        const progress      = document.getElementById('progress-bar-inner');
        const ariaLive      = document.getElementById('aria-live');

        /* ==============================================================
           EVENT LISTENERS
        ===============================================================*/
        generateBtn.addEventListener('click', generateTimeline);
        resetBtn.addEventListener('click', resetTimeline);
        downloadBtn.addEventListener('click', downloadPlan);
        printBtn.addEventListener('click', () => window.print());
        saveBtn.addEventListener('click', savePlan);
        cancelBtn.addEventListener('click', closeModal);
        yearsInput.addEventListener('input', () => (resetBtn.hidden = true));

        prevBtn.addEventListener('click', () => showYear(currentYearIdx - 1));
        nextBtn.addEventListener('click', () => showYear(currentYearIdx + 1));
        prevBtn.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') showYear(currentYearIdx-1);} );
        nextBtn.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') showYear(currentYearIdx+1);} );

        // Close modal with Escape key
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'&&!editModal.hidden) closeModal();});

        /* ==============================================================
           DRAG‑TO‑SCROLL (mouse & touch)
        ===============================================================*/
        let dragging=false, dragStartX=0, scrollStartX=0;
        function startDrag(pageX){dragging=true;dragStartX=pageX;scrollStartX=timelineYears.scrollLeft;timelineYears.classList.add('dragging');}
        function endDrag(){dragging=false;timelineYears.classList.remove('dragging');}
        function duringDrag(pageX){if(!dragging) return; timelineYears.scrollLeft = scrollStartX - (pageX - dragStartX);}        
        timelineYears.addEventListener('mousedown',e=>startDrag(e.pageX));
        document.addEventListener('mouseup',endDrag);
        timelineYears.addEventListener('mousemove',e=>duringDrag(e.pageX));
        timelineYears.addEventListener('mouseleave',endDrag);
        timelineYears.addEventListener('touchstart',e=>startDrag(e.touches[0].pageX));
        timelineYears.addEventListener('touchend',endDrag);
        timelineYears.addEventListener('touchmove',e=>duringDrag(e.touches[0].pageX));

        /* ==============================================================
           CORE FUNCTIONS
        ===============================================================*/
        function generateTimeline(){
            const yrs = parseInt(yearsInput.value,10);
            if(isNaN(yrs)||yrs<1||yrs>6){alert('Enter between 1 and 6');return;}
            yearsCount = yrs; currentYearIdx = 0; timelineData.clear();
            timelineYears.innerHTML=''; controls.hidden=false; resetBtn.hidden=false;
            progress.style.width='0%'; requestAnimationFrame(()=>progress.style.width='100%');

            const semesters=['Fall','Winter','Summer'];
            for(let y=1; y<=yrs; y++){
                const block=document.createElement('section');
                block.className='year-block'; block.setAttribute('aria-label',`Year ${y}`);
                const title=document.createElement('h2'); title.className='year-title'; title.textContent=`Year ${y}`; block.appendChild(title);
                const wrap=document.createElement('div'); wrap.className='year-semesters';
                semesters.forEach(sem=>{
                    const cellId=`${y}-${sem}`;
                    const cell=document.createElement('button');
                    cell.className='semester-cell'; cell.id=cellId; cell.type='button'; cell.setAttribute('aria-label',`${sem} semester year ${y}`);
                    const h3=document.createElement('h3'); h3.textContent=sem; cell.appendChild(h3);
                    const content=document.createElement('div'); content.className='cell-content'; cell.appendChild(content);
                    cell.addEventListener('click',()=>openModal(cellId));
                    timelineData.set(cellId,''); wrap.appendChild(cell);
                });
                block.appendChild(wrap); timelineYears.appendChild(block);
            }
            yearBlocks=[...document.querySelectorAll('.year-block')];
            showYear(0, false); // jump instantly to first year
            ariaLive.textContent=`${yrs}-year timeline generated.`;
        }

        function showYear(idx, smooth=true){
            if(idx<0||idx>=yearsCount) return;
            currentYearIdx=idx;
            const behavior=smooth?'smooth':'auto';
            yearBlocks[idx].scrollIntoView({behavior,inline:'center',block:'nearest'});
            updateNavVisibility();
        }
        function updateNavVisibility(){
            prevBtn.style.visibility = currentYearIdx===0 ? 'hidden':'visible';
            nextBtn.style.visibility = currentYearIdx===yearsCount-1 ? 'hidden':'visible';
        }

        function resetTimeline(){ timelineYears.innerHTML=''; timelineData.clear(); controls.hidden=true; resetBtn.hidden=true; progress.style.width='0%'; updateNavVisibility(); ariaLive.textContent='Timeline reset.'; }

        /* ─── Modal helpers ─── */
        function openModal(id){ currentEditCell=id; planText.value=timelineData.get(id)||''; editModal.hidden=false; planText.focus(); }
        function closeModal(){ editModal.hidden=true; currentEditCell=null; planText.value=''; }
        function savePlan(){ if(!currentEditCell) return; const val=planText.value.trim(); timelineData.set(currentEditCell,val); const cell=document.getElementById(currentEditCell); if(cell) cell.querySelector('.cell-content').textContent=val; ariaLive.textContent='Plan saved.'; closeModal(); }

        /* ─── Download ─── */
        function downloadPlan(){ if(!timelineData.size){alert('Nothing to download');return;} let out=`Your Path Through TRU (Generated ${new Date().toLocaleDateString()})\n\n`; for(let y=1;y<=yearsCount;y++){ out+=`YEAR ${y}\n`; ['Fall','Winter','Summer'].forEach(s=>{const id=`${y}-${s}`;out+=`  ${s}: ${timelineData.get(id)||''}\n`;}); out+='\n'; } const blob=new Blob([out],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='timeline-plan.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); ariaLive.textContent='Download started'; }
    </script>
</body>
</html>
